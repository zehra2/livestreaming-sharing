var peer_name,roomIdw,agentId,iframeId,offlineEmail,offlinePage,visitor_name,createRoom,configType,lsvdatetime,lsvduration,disableVideo,disableAudio,disable,dataHosts,noOnlineMembers,index,currScript,socket,currVersion=15,isOnline=!1,popupInstance=null,openTab=!1,autoReconnectInterval=5e3;null!=(currScript=document.currentScript||document.getElementById("newdev-embed-script"))&&null!=currScript||(index=(scripts=document.getElementsByTagName("script")).length-1,currScript=scripts[index]);var lsRepUrl=currScript.getAttribute("data-source_path");if(null==lsRepUrl||null==lsRepUrl)for(var scripts,i=0,l=(scripts=document.getElementsByTagName("script")).length;i<l;i++)if(scripts[i].getAttribute("data-source_path")){currScript=scripts[i],lsRepUrl=currScript.getAttribute("data-source_path");break}function makeid(e){let t="";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=r.length;let i=0;for(;i<e;)t+=r.charAt(Math.floor(Math.random()*o)),i+=1;return t}var initVideoNewDev=function(){var n,t=currScript.getAttribute("data-button_css")?currScript.getAttribute("data-button_css"):"button_gray.css",o=currScript.getAttribute("data-message")?currScript.getAttribute("data-message"):"Start Video Chat";peer_name=currScript.getAttribute("data-host_name")?currScript.getAttribute("data-host_name"):"",visitor_name=currScript.getAttribute("data-visitor_name")?currScript.getAttribute("data-visitor_name"):"",agentId=currScript.getAttribute("data-tenant")?currScript.getAttribute("data-tenant"):"",roomIdw=(roomIdw=currScript.getAttribute("data-room_id")?currScript.getAttribute("data-room_id"):agentId)||makeid(10),iframeId=currScript.getAttribute("data-iframe_id")?currScript.getAttribute("data-iframe_id"):"",offlineEmail=currScript.getAttribute("data-offline_email")?currScript.getAttribute("data-offline_email"):"",offlinePage=currScript.getAttribute("data-offline_page")?currScript.getAttribute("data-offline_page"):"",openTab=!!currScript.getAttribute("data-intab")&&currScript.getAttribute("data-intab"),configType=!!currScript.getAttribute("data-config")&&currScript.getAttribute("data-config"),lsvdatetime=!!currScript.getAttribute("data-datetime")&&currScript.getAttribute("data-datetime"),lsvduration=!!currScript.getAttribute("data-duration")&&currScript.getAttribute("data-duration"),disableVideo=!!currScript.getAttribute("data-disablevideo"),disableAudio=!!currScript.getAttribute("data-disableaudio"),disable=!!currScript.getAttribute("data-disable"),dataHosts=!!currScript.getAttribute("data-hosts")&&currScript.getAttribute("data-hosts"),createRoom=currScript.getAttribute("data-cr")?currScript.getAttribute("data-cr"):"",noOnlineMembers=currScript.getAttribute("data-noonline")?currScript.getAttribute("data-noonline"):"There are no online staff members";function a(e){if(e&&(roomIdw=e.target.getAttribute("data-room"),e.stopPropagation(),document.querySelector("#widget_tooltip_container").style.display="none"),popupInstance&&!popupInstance.closed)popupInstance.focus();else{var t=screen.width-100,r=screen.height-100,o=screen.width/2-t/2,i=screen.height/2-r/2,e={request:!0};peer_name&&(e.agentName=peer_name),visitor_name&&(e.visitorName=visitor_name),agentId&&(e.agentId=agentId),configType&&(e.config=configType),lsvdatetime&&(e.datetime=lsvdatetime),lsvduration&&(e.duration=lsvduration),disableVideo&&(e.disableVideo=!0),disableAudio&&(e.disableAudio=!0),disable&&(e.disable=!0);e=window.btoa(unescape(encodeURIComponent(JSON.stringify(e)))),i=openTab?"":"width="+t+", height="+r+", left="+o+", top="+i+", location=no, menubar=no, resizable=yes, scrollbars=no, status=no, titlebar=no, toolbar = no";if(n=lsRepUrl+roomIdw+"?p="+e,iframeId)document.getElementById(iframeId).setAttribute("src",n);else{popupInstance=window.open("","popup_instance",i);try{"about:blank"===popupInstance.location.href&&(popupInstance.location.href=n)}catch(e){}popupInstance.focus()}}}var r=function(){fetch(lsRepUrl+"server/script.php",{method:"POST",body:JSON.stringify({type:"getapikey"})}).then(e=>{e&&loadScript(lsRepUrl+"/socket.io/socket.io.js",i)})};var i=function(){(socket=io(lsRepUrl)).request=function(e,o={}){return new Promise((t,r)=>{socket.emit(e,o,e=>{e.error?r(e.error):t(e)})})},socket.on("connect",function(){var e;createRoom&&(socket.request("createRoom",{room_id:createRoom}).then(function(e){e={room_id:e.id,peer_info:{peer_admin:1,peer_name:createRoom}};socket.request("join",e).then(async function(e){}.bind(this)).catch(e=>{console.error("Join error:",e)})}.bind(this)).catch(e=>{console.error("Create room error:",e)}),socket.on("requestSession",function(e){!function(t,r){let o=new Audio(lsRepUrl+"media/ringtone.mp3");try{o.volume=.5,o.play()}catch(e){o.volume=.5,o.play()}"Notification"in window?"granted"===Notification.permission?new Notification(t,r):"denied"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&new Notification(t,r)}):console.error("This browser does not support notifications.")}("Video request",{body:$("#request_session").text().replace("{{visitor}}",e.peer_name)}),$("#requestModal").modal("show"),$("#request_session").text($("#request_session").text().replace("{{visitor}}",e.peer_name));new URL(window.location.href);let t={admin:1};t.config=e.room_id,agentUrl=lsRepUrl+e.room_id+"?p="+window.btoa(unescape(encodeURIComponent(JSON.stringify(t)))),$(document).on("click","#openUrl",function(){window.open(agentUrl,"_blank"),$("#requestModal").modal("hide"),socket.request("exitRoom").catch(e=>{console.error("Create room error:",e)})}),$(document).on("click","#closeUrl",function(){$("#requestModal").modal("hide"),socket.request("exitRoomAll").catch(e=>{console.error("Create room error:",e)})})}.bind(this))),dataHosts||(e=function(){socket.request("checkPresence",{room_id:agentId}).then(function(e){(isOnline=!!e)&&""==agentId&&(agentId=roomIdw=e),-1!=agentId.indexOf(",")&&Array.isArray(e)&&(dataHosts=agentId),c()}.bind(this)).catch(e=>{isOnline=!1,c(),console.error("Create room error:",e)}),setTimeout(function(){e()},5e3)})()}.bind(this)),socket.on("disconnect",function(){isOnline=!1,c()}.bind(this)),socket.on("producerClosed",function(){isOnline=!1,c()}.bind(this)),socket.on("exitRoom",function(){isOnline=!1,c()}.bind(this));let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=lsRepUrl+"css/"+t+"?v="+currVersion,document.getElementsByTagName("HEAD")[0].appendChild(e),$container=document.getElementById("nd-widget-container"),d($container)},c=function(){isOnline?document.getElementById("widget_but_span").setAttribute("class","online-bnt"):document.getElementById("widget_but_span")&&document.getElementById("widget_but_span").setAttribute("class","offline-bnt")};function s(e){for(;e.firstElementChild;)e.firstElementChild.remove()}var d=function(r){fetch(lsRepUrl+"pages/button.html").then(function(e){if(e.ok)return e.text();throw e}).then(function(e){r.innerHTML=e,document.querySelector("#newdev_widget_msg").innerHTML=o,dataHosts&&(document.querySelector("#widget_but_span").style.display="none");const t=document.querySelector("#widget-but");t.addEventListener("click",e=>{var o,i,n,t;dataHosts?(o=!1,i=document.querySelector("#widget_tooltip_container"),n=document.querySelector("#nd-widget-container").offsetTop,i.style.display="",t=dataHosts.split(","),s(i),i.classList.add("bottom"),s(i),t.forEach(function(e){var r;e&&(e=(r=e.split("|"))[0],socket.request("checkPresence",{room_id:e}).then(function(e){var t;Array.isArray(e)&&0<e.length&&(o=!0,(t=document.querySelector("#lsv-product-template").cloneNode(!0)).style.display="",n<100&&(t.style.top="40px",t.style.position="absolute"),t.querySelector(".lsv-product-name").innerText=r[1],t.querySelector(".lsv-product-name").setAttribute("id","href"+e),t.querySelector(".lsv-product-name").setAttribute("data-room",e),i.appendChild(t),i.style.display="",document.getElementById("href"+e).addEventListener("click",a,!1))}.bind(this)).catch(e=>{console.error("Create room error:",e)}))}),setTimeout(function(){var e;o||((e=document.querySelector("#lsv-product-template").cloneNode(!0)).style.display="",e.querySelector(".lsv-product-name").innerText=noOnlineMembers,n<100&&(e.style.top="40px",e.style.position="absolute"),i.appendChild(e),i.style.display="",setTimeout(function(){s(i)},4e3))},2e3)):isOnline?a():offlineEmail?(document.querySelector("#widget_tooltip_container").style.display="",document.querySelector("#widget_tooltip_container").addEventListener("click",e=>{document.querySelector("#widget_tooltip_container").style.display="none",e.stopPropagation()}),document.querySelector("#offline_message").addEventListener("click",e=>{e.stopPropagation()}),document.querySelector("#sendEmail").addEventListener("click",e=>{document.querySelector("#widget_tooltip_container").style.display="none";var t=document.querySelector("#offline_message").value;document.location.href="mailto:"+offlineEmail+"?subject=Offline request&body="+t})):offlinePage&&(-1===offlinePage.indexOf("http")&&(offlinePage="http://"+offlinePage),window.location.href=offlinePage)})})};fetch(lsRepUrl+"config/config.json?v="+currVersion).then(e=>e.json()).then(e=>{svConfigs=e,r()})};function loadScript(e,t){var r=document.createElement("script");r.type="text/javascript",r.readyState?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(r.onreadystatechange=null,t&&t())}:(r.onload=function(){t&&t()},r.onerror=function(){setTimeout(function(){loadScript(e,t)},autoReconnectInterval)}),r.src=e+"?v="+currVersion,document.getElementsByTagName("head")[0].appendChild(r)}var ms=Date.now();fetch(lsRepUrl+"pages/version.txt?v="+ms).then(e=>e.text()).then(e=>{currVersion=e,new initVideoNewDev});